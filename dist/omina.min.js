"use strict";function def(e,t,a,r){Object.defineProperty(e,t,{value:a,enumerable:!!r,writable:!0,configurable:!0})}Object.defineProperty(exports,"__esModule",{value:!0});var hasOwnProperty=Object.prototype.hasOwnProperty;function hasOwn(e,t){return hasOwnProperty.call(e,t)}var _toString=Object.prototype.toString;function isPlainObject(e){return"[object Object]"===_toString.call(e)}function isValidArrayIndex(e){var t=parseFloat(String(e));return 0<=t&&Math.floor(t)===t&&isFinite(e)}function remove(e,t){if(e.length){var a=e.indexOf(t);if(-1<a)return e.splice(a,1)}}var nextTick=wx.nextTick?wx.nextTick:setTimeout,uid=0,Dep=function(){this.id=++uid,this.subs=[]};Dep.prototype.depend=function(){Dep.target&&Dep.target.addDep(this)},Dep.prototype.addSub=function(e){this.subs.push(e)},Dep.prototype.removeSub=function(e){remove(this.subs,e)},Dep.prototype.notify=function(){this.subs.slice().forEach(function(e){return e.update()})},Dep.target=null;var targetStack=[];function pushTarget(e){Dep.target&&targetStack.push(Dep.target),Dep.target=e}function popTarget(){Dep.target=targetStack.pop()}var arrayProto=Array.prototype,arrayMethods=Object.create(arrayProto),methodsToPatch=["push","pop","shift","unshift","splice","sort","reverse"];methodsToPatch.forEach(function(n){var i=arrayProto[n];def(arrayMethods,n,function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var a,r=i.apply(this,e),o=this.__ob__;switch(n){case"push":case"unshift":a=e;break;case"splice":a=e.slice(2)}return a&&o.observeArray(a),o.dep.notify(),r})});var arrayKeys=Object.getOwnPropertyNames(arrayMethods);function copyAugment(t,a,e){e.forEach(function(e){def(t,e,a[e])})}var Observer=function(e){this.value=e,this.dep=new Dep,def(e,"__ob__",this),Array.isArray(e)?(copyAugment(e,arrayMethods,arrayKeys),this.observeArray(e)):this.walk(e)};function observe(e){var t;if(e&&"object"==typeof e)return hasOwn(e,"__ob__")&&e.__ob__ instanceof Observer?t=e.__ob__:(Array.isArray(e)||isPlainObject(e))&&Object.isExtensible(e)&&(t=new Observer(e)),t}function defineReactive(e,t,a){var r=new Dep;2===arguments.length&&(a=e[t]);var o=observe(a);Object.defineProperty(e,t,{enumerable:!0,configurable:!1,get:function(){return Dep.target&&(r.depend(),o&&(o.dep.depend(),Array.isArray(a)&&dependArray(a))),a},set:function(e){a!==e&&(o=observe(a=e),r.notify())}})}function dependArray(e){for(var t=void 0,a=0,r=e.length;a<r;a++)(t=e[a])&&t.__ob__&&t.__ob__.dep.depend(),Array.isArray(t)&&dependArray(t)}function set(e,t,a){if(Array.isArray(e)&&isValidArrayIndex(t))return e.length=Math.max(e.length,t),e.splice(t,1,a),a;if(t in e&&!(t in Object.prototype))return e[t]=a;var r=e.__ob__;return r?(defineReactive(r.value,t,a),r.dep.notify(),a):e[t]=a}function del(e,t){if(Array.isArray(e)&&isValidArrayIndex(t))e.splice(t,1);else if(!hasOwn(e,t)){var a=e.__ob__;delete e[t],a&&a.dep.notify()}}Observer.prototype.walk=function(t){Object.keys(t).forEach(function(e){defineReactive(t,e)})},Observer.prototype.observeArray=function(e){e.forEach(function(e){return observe(e)})};var watcherQueue=[],has={},pageMap={};function flushSchedulerQueue(){Object.keys(pageMap).forEach(function(e){var t=pageMap[e],a=t.expQueue.reduce(function(e,t){return e[t.key]=t.exp(getApp()),e},{});t.ctx.setData(a)}),has={},watcherQueue.length=0}function queueWatcher(e){var t=e.id;if(!has[t]){has[t]=!0;var a=e.ctx,r=e.exp,o=e.key,n=a.route;pageMap[n]=pageMap[n]||{ctx:a,expQueue:[]},pageMap[n].expQueue.push({exp:r,key:o}),1===watcherQueue.push(e)&&nextTick(flushSchedulerQueue)}}var uid$1=0,Watcher=function(e,t,a){if((this.ctx=e).$watchers=(e.$watchers||[]).concat(this),this.getter=t,this.id=++uid$1,this.deps=[],this.depIds=new Set,this.value=this.get(),!a)throw new Error("小程序环境 watcher 必须提供 options");this.isMapStateWatcher=!!a.isMapStateWatcher,this.exp=a.exp,this.key=a.key};function mitt(r){return r=r||Object.create(null),{on:function(e,t){(r[e]||(r[e]=[])).push(t)},off:function(e,t){r[e]&&r[e].splice(r[e].indexOf(t)>>>0,1)},emit:function(t,a){(r[t]||[]).slice().map(function(e){e(a)}),(r["*"]||[]).slice().map(function(e){e(t,a)})}}}Watcher.prototype.get=function(){pushTarget(this);var e=this.getter();return popTarget(),e},Watcher.prototype.update=function(){queueWatcher(this)},Watcher.prototype.run=function(){},Watcher.prototype.addDep=function(e){var t=e.id;this.depIds.has(t)||(this.depIds.add(t),this.deps.push(e),e.addSub(this))},Watcher.prototype.teardown=function(){for(var e=this.deps.length;e--;)this.deps[e].removeSub(this)};var emitter=mitt();function page(e){var a=e.onLoad,t=e.onUnload,i=e.mapData;return e.onLoad=function(e){var n=this,t=getCurrentPages();this.$prevPage=t[t.length-2],this.$prevPage&&(e.params=this.$prevPage.$nextPageParams,delete this.$prevPage.$nextPageParams),i&&Object.keys(i).forEach(function(r){var o=i[r];new Watcher(n,function(e){var t,a=o(getApp());return n.setData(((t={})[r]=a,t)),a},{isMapStateWatcher:!0,exp:o,key:r})}),Object.defineProperties(this,{$app:{get:getApp}}),a&&a.call(this,e)},e.$navTo=function(e){var t=e.url,a=e.params;this.__params=a,wx.navigateTo({url:t})},e.$on=function(e,t){if("function"==typeof t)return this.events=this.events||Object.create(null),this.events[e]=this.events[e]||[],this.events[e].push(t),emitter.on(e,t)},e.$emit=function(e){for(var t=[],a=arguments.length-1;0<a--;)t[a]=arguments[a+1];return emitter.emit.apply(emitter,[e].concat(t))},e.$set=set,e.$del=del,e.onUnload=function(){var e=this;Array.isArray(this.$watchers)&&this.$watchers.forEach(function(e){e.teardown()}),delete this.$watchers,Object.keys(this.events).forEach(function(t){e.events[t].forEach(function(e){emitter.off(t,e)})}),t&&t.call(this)},Page(e)}var onAndSyncApis={onSocketOpen:!0,onSocketError:!0,onSocketMessage:!0,onSocketClose:!0,onBackgroundAudioPlay:!0,onBackgroundAudioPause:!0,onBackgroundAudioStop:!0,onNetworkStatusChange:!0,onAccelerometerChange:!0,onCompassChange:!0,onBluetoothAdapterStateChange:!0,onBluetoothDeviceFound:!0,onBLEConnectionStateChange:!0,onBLECharacteristicValueChange:!0,onBeaconUpdate:!0,onBeaconServiceChange:!0,onUserCaptureScreen:!0,onHCEMessage:!0,onGetWifiList:!0,onWifiConnected:!0,setStorageSync:!0,getStorageSync:!0,getStorageInfoSync:!0,removeStorageSync:!0,clearStorageSync:!0,getSystemInfoSync:!0,getExtConfigSync:!0,getLogManager:!0},noPromiseApis={stopRecord:!0,getRecorderManager:!0,pauseVoice:!0,stopVoice:!0,pauseBackgroundAudio:!0,stopBackgroundAudio:!0,getBackgroundAudioManager:!0,createAudioContext:!0,createInnerAudioContext:!0,createVideoContext:!0,createCameraContext:!0,createLivePlayerContext:!0,createLivePusherContext:!0,createMapContext:!0,canIUse:!0,startAccelerometer:!0,stopAccelerometer:!0,startCompass:!0,stopCompass:!0,hideToast:!0,hideLoading:!0,showNavigationBarLoading:!0,hideNavigationBarLoading:!0,createAnimation:!0,pageScrollTo:!0,createSelectorQuery:!0,createCanvasContext:!0,createContext:!0,drawCanvas:!0,hideKeyboard:!0,stopPullDownRefresh:!0,createIntersectionObserver:!0,arrayBufferToBase64:!0,base64ToArrayBuffer:!0,getUpdateManager:!0,createWorker:!0},otherApis={uploadFile:!0,downloadFile:!0,connectSocket:!0,sendSocketMessage:!0,closeSocket:!0,request:!0,chooseImage:!0,previewImage:!0,getImageInfo:!0,saveImageToPhotosAlbum:!0,startRecord:!0,playVoice:!0,getBackgroundAudioPlayerState:!0,playBackgroundAudio:!0,seekBackgroundAudio:!0,chooseVideo:!0,saveVideoToPhotosAlbum:!0,loadFontFace:!0,saveFile:!0,getFileInfo:!0,getSavedFileList:!0,getSavedFileInfo:!0,removeSavedFile:!0,openDocument:!0,setStorage:!0,getStorage:!0,getStorageInfo:!0,removeStorage:!0,clearStorage:!0,navigateBack:!0,navigateTo:!0,redirectTo:!0,switchTab:!0,reLaunch:!0,getLocation:!0,chooseLocation:!0,openLocation:!0,getSystemInfo:!0,getNetworkType:!0,makePhoneCall:!0,scanCode:!0,setClipboardData:!0,getClipboardData:!0,openBluetoothAdapter:!0,closeBluetoothAdapter:!0,getBluetoothAdapterState:!0,startBluetoothDevicesDiscovery:!0,stopBluetoothDevicesDiscovery:!0,getBluetoothDevices:!0,getConnectedBluetoothDevices:!0,createBLEConnection:!0,closeBLEConnection:!0,getBLEDeviceServices:!0,getBLEDeviceCharacteristics:!0,readBLECharacteristicValue:!0,writeBLECharacteristicValue:!0,notifyBLECharacteristicValueChange:!0,startBeaconDiscovery:!0,stopBeaconDiscovery:!0,getBeacons:!0,setScreenBrightness:!0,getScreenBrightness:!0,setKeepScreenOn:!0,vibrateLong:!0,vibrateShort:!0,addPhoneContact:!0,getHCEState:!0,startHCE:!0,stopHCE:!0,sendHCEMessage:!0,startWifi:!0,stopWifi:!0,connectWifi:!0,getWifiList:!0,setWifiList:!0,getConnectedWifi:!0,showToast:!0,showLoading:!0,showModal:!0,showActionSheet:!0,setNavigationBarTitle:!0,setNavigationBarColor:!0,setTabBarBadge:!0,removeTabBarBadge:!0,showTabBarRedDot:!0,hideTabBarRedDot:!0,setTabBarStyle:!0,setTabBarItem:!0,showTabBar:!0,hideTabBar:!0,setTopBarText:!0,startPullDownRefresh:!0,canvasToTempFilePath:!0,canvasGetImageData:!0,canvasPutImageData:!0,getExtConfig:!0,login:!0,checkSession:!0,authorize:!0,getUserInfo:!0,checkIsSupportFacialRecognition:!0,startFacialRecognitionVerify:!0,startFacialRecognitionVerifyAndUploadVideo:!0,requestPayment:!0,showShareMenu:!0,hideShareMenu:!0,updateShareMenu:!0,getShareInfo:!0,chooseAddress:!0,addCard:!0,openCard:!0,openSetting:!0,getSetting:!0,getWeRunData:!0,navigateToMiniProgram:!0,navigateBackMiniProgram:!0,chooseInvoiceTitle:!0,checkIsSupportSoterAuthentication:!0,startSoterAuthentication:!0,checkIsSoterEnrolledInDevice:!0};function processApis(e){var t=Object.assign({},onAndSyncApis,noPromiseApis,otherApis);Object.keys(t).forEach(function(n){onAndSyncApis[n]||noPromiseApis[n]?e[n]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return wx[n].apply(wx,e)}:e[n]=function(o){o=o||{};var t=null,e=Object.assign({},o);if("string"==typeof o)return wx[n](o);var a=new Promise(function(a,r){["fail","success","complete"].forEach(function(t){e[t]=function(e){o[t]&&o[t](e),"success"===t?a(e):"fail"===t&&r(e)}}),t=wx[n](e)});return"uploadFile"!==n&&"downloadFile"!==n||(a.progress=function(e){return t.onProgressUpdate(e),a},a.abort=function(e){return e&&e(),t.abort(),a}),a}})}function wxApp(e){var a=e.onLaunch;return e.onLaunch=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];processApis(this),this.globalData=this.globalData||{},observe(this.globalData),a&&a.bind(this).apply(void 0,e)},e.bus=mitt(),e.set=set,e.del=del,App(e)}exports.page=page,exports.app=wxApp;
